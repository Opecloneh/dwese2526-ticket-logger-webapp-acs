<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head ('Ticket Logger - Usuarios')"></head>

<body class="d-flex flex-column h-100">

<header th:replace="fragments/header :: header"></header>

<main class="d-flex justify-content-center align-items-center flex-fill p-3">
    <div class="card w-100" style="max-width: 500px; max-height: 80vh; overflow-y: auto;">
        <div class="card-body">
        <div class="text-center mb-3">
            <img th:src="${userProfileForm.profileImage != null} ? ${userProfileForm.profileImage} : @{/images/avatar.svg}"
                 alt="Avatar"
                 class="img-thumbnail rounded-circle"
                 style="width: 120px; height: 120px; object-fit: cover;">

        </div>

        <!-- Título -->
        <h1 th.text="#{msg.userProfile.title}"></h1>
        <p class="text-muted" th:text="#{msg.userProfile.subtitle}"></p>

        <!-- Mensaje de error -->
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <!-- Mensaje de error -->
        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

        <!-- Formulario de creación -->
        <form th:action="@{/profile/update}" th:object="${userProfileForm}" enctype="multipart/form-data" method="post" class="mt-3">
            <input type="hidden" th:field="*{userId}"/>
            <!-- Email -->
            <div class="form-check mb-3">
                <label for="email" class="form-label" th:text="#{msg.userProfile.field.email}"></label>
                <input type="text" th:field="*{email}" id="email" class="form-control" readonly/>
            </div>
            <!-- Nombre -->
            <div class="form-check mb-3">
                <label for="firstName" class="form-label" th:text="#{msg.userProfile.field.firstName}"></label>
                <input type="text" th:field="*{firstName}" id="firstName" class="form-control"/>
                <div th:if="${#fields.hasErrors('firstName')}" class="text-danger" th:errors="*{firstName}"></div>
            </div>
            <!-- Apellidos -->
            <div class="form-check mb-3">
                <label for="lastName" class="form-label" th:text="#{msg.userProfile.field.lastName}"></label>
                <input type="text" th:field="*{lastName}" id="lastName" class="form-control"/>
                <div th:if="${#fields.hasErrors('lastName')}" class="text-danger" th:errors="*{lastName}"></div>
            </div>
            <!-- Telefono -->
            <div class="form-check mb-3">
                <label for="phoneNumber" class="form-label" th:text="#{msg.userProfile.field.phoneNumber}"></label>
                <input type="text" th:field="*{phoneNumber}" id="phoneNumber" class="form-control"/>
                <div th:if="${#fields.hasErrors('phoneNumber')}" class="text-danger" th:errors="*{phoneNumber}"></div>
            </div>
            <!-- Imagen de perfil (URL/Ruta) -->
            <div class="form-check mb-3">
                <label for="profileImage" class="form-label" th:text="#{msg.userProfile.field.profileImage}"></label>
                <input type="text" th:field="*{profileImage}" id="profileImage" class="form-control"/>
                <div th:if="${#fields.hasErrors('profileImage')}" class="text-danger" th:errors="*{profileImage}"></div>
            </div>
            <!-- Biografia -->
            <div class="form-check mb-3">
                <label for="bio" class="form-label" th:text="#{msg.userProfile.field.bio}"></label>
                <input type="text" th:field="*{bio}" id="bio" class="form-control"/>
                <div th:if="${#fields.hasErrors('bio')}" class="text-danger" th:errors="*{bio}"></div>
            </div>
            <!-- Idioma preferido -->
            <div class="form-check mb-3">
                <label for="locale" class="form-label" th:text="#{msg.userProfile.field.locale}"></label>
                <input type="text" th:field="*{locale}" id="locale" class="form-control" placeholder="es_ES, en_GB, ..."/>
                <div th:if="${#fields.hasErrors('locale')}" class="text-danger" th:errors="*{locale}"></div>
            </div>
            <!-- Input de subida de nueva imagen -->
            <label for="profileImageFile" class="form-label"
                   th:text="#{msg.userProfile.field.profileImageUpload}"></label>
            <input type="file"
                   id="profileImageFile"
                   name="profileImageFile"
                   class="form-control"
                   accept="image/*" />

            <small class="form-text text-muted" th:text="#{msg.userProfile.field.profileImageUpload.help}"></small>

            <br>
            <button type="submit" class="btn btn-primary" th:text="#{msg.userProfile.action.save}"></button>
            <a th:href="@{/}" class="btn btn-secondary ms-2" th:text="#{msg.userProfile.action.back}"></a>
        </form>
    </div>
    </div>
</main>

<footer th:replace="fragments/footer :: footer"></footer>
<div th:replace="fragments/scripts :: scripts"></div>

</body>
</html>
